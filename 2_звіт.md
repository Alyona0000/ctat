# –ö–∏—ó–≤—Å—å–∫–∏–π –Ω–∞—Ü—ñ–æ–Ω–∞–ª—å–Ω–∏–π —É–Ω—ñ–≤–µ—Ä—Å–∏—Ç–µ—Ç —ñ–º–µ–Ω—ñ –¢–∞—Ä–∞—Å–∞ –®–µ–≤—á–µ–Ω–∫–∞  
## –ú–µ—Ö–∞–Ω—ñ–∫–æ-–º–∞—Ç–µ–º–∞—Ç–∏—á–Ω–∏–π —Ñ–∞–∫—É–ª—å—Ç–µ—Ç  

### –°–ê–ú–û–°–¢–Ü–ô–ù–ê –†–û–ë–û–¢–ê  
–∑ –∫—É—Ä—Å—É  
**¬´–í–°–¢–£–ü –î–û –°–¢–ê–¢–ò–°–¢–ò–ö–ò¬ª**

–Ω–∞ —Ç–µ–º—É:  
**¬´–í—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è —Ä–æ–∑–ø–æ–¥—ñ–ª—É –æ–¥–Ω–æ–º—ñ—Ä–Ω–∏—Ö –¥–∞–Ω–∏—Ö¬ª**

–í–∏–∫–æ–Ω–∞–ª–∞:  
—Å—Ç—É–¥–µ–Ω—Ç–∫–∞ 2 –∫—É—Ä—Å—É  
—Å–ø–µ—Ü—ñ–∞–ª—å–Ω–æ—Å—Ç—ñ ¬´–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞¬ª  
**–†–∏–±–∞–∫–æ–≤–∞ –ê–ª—å–æ–Ω–∞**

---

## –ü—É–Ω–∫—Ç 1. –ó–±—ñ—Ä —Ç–∞ –ø—ñ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–∏—Ö

–î–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —Ä–æ–±–æ—Ç–∏ –±—É–ª–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ –Ω–∞–±—ñ—Ä –¥–∞–Ω–∏—Ö –∑ –∞—Ä—Ö—ñ–≤—É `daily_sp500.zip`, —è–∫–∏–π –º—ñ—Å—Ç–∏—Ç—å —â–æ–¥–µ–Ω–Ω—ñ –¥–∞–Ω—ñ –ø—Ä–æ —Ü—ñ–Ω–∏ –∞–∫—Ü—ñ–π –∫–æ–º–ø–∞–Ω—ñ–π, —â–æ –≤—Ö–æ–¥—è—Ç—å –¥–æ —ñ–Ω–¥–µ–∫—Å—É S&P 500.

–í—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ –¥–æ –≤–∞—Ä—ñ–∞–Ω—Ç—É 1 –±—É–ª–æ –æ–±—Ä–∞–Ω–æ –¥–≤—ñ –∫–æ–º–ø–∞–Ω—ñ—ó, –Ω–∞–∑–≤–∏ —è–∫–∏—Ö –ø–æ—á–∏–Ω–∞—é—Ç—å—Å—è –∑ –ª—ñ—Ç–µ—Ä **A** —Ç–∞ **L**:
- Apple Inc. (AAPL)
- Eli Lilly and Company (LLY)

–î–ª—è –∫–æ–∂–Ω–æ—ó –∫–æ–º–ø–∞–Ω—ñ—ó –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–≤—Å—è –æ–∫—Ä–µ–º–∏–π CSV-—Ñ–∞–π–ª –≤–∏–¥—É `table_<mnemonic>.csv`, —â–æ –º—ñ—Å—Ç–∏—Ç—å —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –¥–∞—Ç—É —Ç–æ—Ä–≥—ñ–≤, –º—ñ–Ω—ñ–º–∞–ª—å–Ω—É, –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É —Ç–∞ —Ü—ñ–Ω—É –∑–∞–∫—Ä–∏—Ç—Ç—è –∞–∫—Ü—ñ–π. –î–∞–Ω—ñ –±—É–ª–∏ –∑—á–∏—Ç–∞–Ω—ñ —Ç–∞ –ø—ñ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω—ñ –¥–ª—è –ø–æ–¥–∞–ª—å—à–æ–≥–æ –∞–Ω–∞–ª—ñ–∑—É –≤ —Å–µ—Ä–µ–¥–æ–≤–∏—â—ñ **R**.

```r
required <- c('ggplot2','dplyr','lubridate','readr')
for (pkg in required)
  if (!requireNamespace(pkg, quietly=TRUE))
    install.packages(pkg, repos='https://cloud.r-project.org')

library(ggplot2)
library(dplyr)
library(lubridate)
library(readr)

plot_dir <- file.path(getwd(), 'plots')
out_dir  <- file.path(getwd(), 'outputs')
if (!dir.exists(plot_dir)) dir.create(plot_dir, recursive = TRUE)
if (!dir.exists(out_dir)) dir.create(out_dir, recursive = TRUE)

tickers <- c('aapl','lly')
–ü—É–Ω–∫—Ç 2. –í—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è –≥—ñ—Å—Ç–æ–≥—Ä–∞–º –∞–±—Å–æ–ª—é—Ç–Ω–∏—Ö —á–∞—Å—Ç–æ—Ç

–î–ª—è –∫–æ–∂–Ω–æ—ó –∑ –æ–±—Ä–∞–Ω–∏—Ö –∫–æ–º–ø–∞–Ω—ñ–π –±—É–ª–æ –ø–æ–±—É–¥–æ–≤–∞–Ω–æ –≥—ñ—Å—Ç–æ–≥—Ä–∞–º–∏ –∞–±—Å–æ–ª—é—Ç–Ω–∏—Ö —á–∞—Å—Ç–æ—Ç —Ü—ñ–Ω –∑–∞–∫—Ä–∏—Ç—Ç—è –∞–∫—Ü—ñ–π –∑–∞ –≤–µ—Å—å –ø–µ—Ä—ñ–æ–¥ —Å–ø–æ—Å—Ç–µ—Ä–µ–∂–µ–Ω—å.

for (t in tickers) {
  df <- read_csv(file.path('data', paste0('table_', t, '.csv')),
                 col_types = cols())
  df <- df %>%
    mutate(dat = as.Date(as.character(dat), format='%Y%m%d')) %>%
    arrange(dat)

  p <- ggplot(df, aes(x = clo)) +
    geom_histogram(bins = 40, fill = 'steelblue', color = 'black') +
    ggtitle(paste0(toupper(t), ' ‚Äî —Ü—ñ–Ω–∞ –∑–∞–∫—Ä–∏—Ç—Ç—è (counts)')) +
    xlab('Closing price')

  ggsave(file.path(plot_dir, paste0(t, '_hist_closing_counts.png')),
         plot = p, width = 7, height = 5)
}


–û—Ç—Ä–∏–º–∞–Ω—ñ –≥—ñ—Å—Ç–æ–≥—Ä–∞–º–∏ –ø–æ–∫–∞–∑–∞–ª–∏, —â–æ —Ä–æ–∑–ø–æ–¥—ñ–ª–∏ —Ü—ñ–Ω –∑–∞–∫—Ä–∏—Ç—Ç—è –º–∞—é—Ç—å –∞—Å–∏–º–µ—Ç—Ä–∏—á–Ω—É —Ñ–æ—Ä–º—É —Ç–∞ –≤—ñ–¥—Ä—ñ–∑–Ω—è—é—Ç—å—Å—è —à–∏—Ä–∏–Ω–æ—é –¥—ñ–∞–ø–∞–∑–æ–Ω—É –∑–Ω–∞—á–µ–Ω—å, —â–æ —Å–≤—ñ–¥—á–∏—Ç—å –ø—Ä–æ —Ä—ñ–∑–Ω–∏–π —Ä—ñ–≤–µ–Ω—å –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—ñ –∞–∫—Ü—ñ–π.

–ü—É–Ω–∫—Ç 3. –ê–Ω–∞–ª—ñ–∑ –∑–º—ñ–Ω–Ω–æ—ó rel

–î–ª—è –∫–æ–∂–Ω–æ–≥–æ –¥–Ω—è —Ç–æ—Ä–≥—ñ–≤ –±—É–ª–æ –æ–±—á–∏—Å–ª–µ–Ω–æ –∑–º—ñ–Ω–Ω—É

ùëü
ùëí
ùëô
=
ùëÉ
ùëö
ùëé
ùë•
ùëÉ
ùëö
ùëñ
ùëõ
,
rel=
P
min
	‚Äã

P
max
	‚Äã

	‚Äã

,

–¥–µ 
ùëÉ
ùëö
ùëé
ùë•
P
max
	‚Äã

 ‚Äî –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞, –∞ 
ùëÉ
ùëö
ùëñ
ùëõ
P
min
	‚Äã

 ‚Äî –º—ñ–Ω—ñ–º–∞–ª—å–Ω–∞ —Ü—ñ–Ω–∞ –∞–∫—Ü—ñ—ó –∑–∞ –¥–µ–Ω—å.

for (t in tickers) {
  df <- read_csv(file.path('data', paste0('table_', t, '.csv')),
                 col_types = cols())
  df <- df %>%
    mutate(rel = mx / mn)

  p <- ggplot(df, aes(x = rel)) +
    geom_histogram(bins = 40, fill = 'darkgreen', color = 'black') +
    ggtitle(paste0(toupper(t), ' ‚Äî rel = high/min')) +
    xlab('rel')

  ggsave(file.path(plot_dir, paste0(t, '_hist_rel_all.png')),
         plot = p, width = 7, height = 5)
}


–ê–Ω–∞–ª—ñ–∑ –ø–æ–∫–∞–∑–∞–≤, —â–æ –±—ñ–ª—å—à—ñ—Å—Ç—å –∑–Ω–∞—á–µ–Ω—å rel –∑–æ—Å–µ—Ä–µ–¥–∂–µ–Ω—ñ –ø–æ–±–ª–∏–∑—É 1, —â–æ –æ–∑–Ω–∞—á–∞—î –≤—ñ–¥–Ω–æ—Å–Ω–æ —Å—Ç–∞–±—ñ–ª—å–Ω—É –¥–∏–Ω–∞–º—ñ–∫—É —Ü—ñ–Ω —É–ø—Ä–æ–¥–æ–≤–∂ —Ç–æ—Ä–≥–æ–≤–æ–≥–æ –¥–Ω—è.

–ü—É–Ω–∫—Ç 4. –°–∫—Ä–∏–Ω—å–∫–∏ –∑ –≤—É—Å–∞–º–∏ –¥–ª—è —Ü—ñ–Ω –∑–∞–∫—Ä–∏—Ç—Ç—è –∑–∞ —Ä–æ–∫–∞–º–∏

–î–ª—è –∫–æ–∂–Ω–æ—ó –∫–æ–º–ø–∞–Ω—ñ—ó –±—É–ª–æ –ø–æ–±—É–¥–æ–≤–∞–Ω–æ boxplot-–¥—ñ–∞–≥—Ä–∞–º–∏ —Ü—ñ–Ω –∑–∞–∫—Ä–∏—Ç—Ç—è –∞–∫—Ü—ñ–π –æ–∫—Ä–µ–º–æ –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ —Ä–æ–∫—É.

for (t in tickers) {
  df <- read_csv(file.path('data', paste0('table_', t, '.csv')),
                 col_types = cols())
  df <- df %>%
    mutate(dat = as.Date(as.character(dat), format='%Y%m%d'),
           year = year(dat))

  p <- ggplot(df, aes(x = factor(year), y = clo)) +
    geom_boxplot(outlier.size = 0.8) +
    theme(axis.text.x = element_text(angle = 90)) +
    xlab('Year') + ylab('Closing price') +
    ggtitle(paste0(toupper(t), ' ‚Äî Closing price by year'))

  ggsave(file.path(plot_dir, paste0(t, '_boxplot_by_year.png')),
         plot = p, width = 10, height = 5)
}

–ü—É–Ω–∫—Ç 5. –ê–Ω–∞–ª—ñ–∑ –æ–¥–Ω–æ—Ä—ñ–¥–Ω–∏—Ö —á–∞—Å–æ–≤–∏—Ö —ñ–Ω—Ç–µ—Ä–≤–∞–ª—ñ–≤

–ë—É–ª–æ –≤–∏–¥—ñ–ª–µ–Ω–æ 2‚Äì3 —á–∞—Å–æ–≤—ñ —ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏, –Ω–∞ —è–∫–∏—Ö —Ä–æ–∑–ø–æ–¥—ñ–ª —Ü—ñ–Ω –∑–∞–∫—Ä–∏—Ç—Ç—è –º–æ–∂–Ω–∞ –≤–≤–∞–∂–∞—Ç–∏ –≤—ñ–¥–Ω–æ—Å–Ω–æ –æ–¥–Ω–æ—Ä—ñ–¥–Ω–∏–º.

count_density_peaks <- function(x) {
  x <- x[!is.na(x) & is.finite(x)]
  d <- density(x)
  sum(diff(sign(diff(d$y))) == -2)
}


–î–ª—è –∫–æ–∂–Ω–æ–≥–æ –∑ —ñ–Ω—Ç–µ—Ä–≤–∞–ª—ñ–≤ –±—É–ª–æ –ø–æ–±—É–¥–æ–≤–∞–Ω–æ –≥—ñ—Å—Ç–æ–≥—Ä–∞–º–∏ –≤—ñ–¥–Ω–æ—Å–Ω–∏—Ö —á–∞—Å—Ç–æ—Ç —Ü—ñ–Ω –∑–∞–∫—Ä–∏—Ç—Ç—è, –∑–æ–±—Ä–∞–∂–µ–Ω—ñ –Ω–∞ –æ–¥–Ω–æ–º—É –≥—Ä–∞—Ñ—ñ–∫—É.

–ü—É–Ω–∫—Ç 6. –ì—ñ—Å—Ç–æ–≥—Ä–∞–º–∏ rel –¥–ª—è –æ–±—Ä–∞–Ω–∏—Ö —ñ–Ω—Ç–µ—Ä–≤–∞–ª—ñ–≤

–î–ª—è —Ç–∏—Ö —Å–∞–º–∏—Ö —á–∞—Å–æ–≤–∏—Ö —ñ–Ω—Ç–µ—Ä–≤–∞–ª—ñ–≤ –±—É–ª–æ –ø–æ–±—É–¥–æ–≤–∞–Ω–æ –≥—ñ—Å—Ç–æ–≥—Ä–∞–º–∏ –≤—ñ–¥–Ω–æ—Å–Ω–∏—Ö —á–∞—Å—Ç–æ—Ç –∑–º—ñ–Ω–Ω–æ—ó rel.

p <- ggplot(df_join, aes(x = rel, color = Period, fill = Period)) +
  geom_histogram(aes(y = ..density..),
                 bins = 30, alpha = 0.35, position = 'identity') +
  ggtitle('rel (high/min) –¥–ª—è –≤–∏–±—Ä–∞–Ω–∏—Ö —ñ–Ω—Ç–µ—Ä–≤–∞–ª—ñ–≤') +
  xlab('rel')

–í–∏—Å–Ω–æ–≤–∫–∏

–£ —Ö–æ–¥—ñ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —Ä–æ–±–æ—Ç–∏ –±—É–ª–æ –¥–æ—Å–ª—ñ–¥–∂–µ–Ω–æ —Ä–æ–∑–ø–æ–¥—ñ–ª–∏ —Ü—ñ–Ω –∞–∫—Ü—ñ–π –¥–≤–æ—Ö –∫–æ–º–ø–∞–Ω—ñ–π —ñ–Ω–¥–µ–∫—Å—É S&P 500 –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –º–µ—Ç–æ–¥—ñ–≤ –≤—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—ó –æ–¥–Ω–æ–º—ñ—Ä–Ω–∏—Ö –¥–∞–Ω–∏—Ö.

–ü–æ–±—É–¥–æ–≤–∞–Ω—ñ –≥—ñ—Å—Ç–æ–≥—Ä–∞–º–∏ —Ç–∞ boxplot-–¥—ñ–∞–≥—Ä–∞–º–∏ –¥–æ–∑–≤–æ–ª–∏–ª–∏ –Ω–∞–æ—á–Ω–æ –ø—Ä–æ–∞–Ω–∞–ª—ñ–∑—É–≤–∞—Ç–∏ —Ñ–æ—Ä–º—É —Ä–æ–∑–ø–æ–¥—ñ–ª—ñ–≤, —ó—Ö –∞—Å–∏–º–µ—Ç—Ä—ñ—é, –≤–∞—Ä—ñ–∞—Ç–∏–≤–Ω—ñ—Å—Ç—å —Ç–∞ –Ω–∞—è–≤–Ω—ñ—Å—Ç—å –≤–∏–∫–∏–¥—ñ–≤. –ê–Ω–∞–ª—ñ–∑ –∑–º—ñ–Ω–Ω–æ—ó rel –ø–æ–∫–∞–∑–∞–≤, —â–æ –≤–Ω—É—Ç—Ä—ñ—à–Ω—å–æ–¥–µ–Ω–Ω—ñ –∫–æ–ª–∏–≤–∞–Ω–Ω—è —Ü—ñ–Ω –∑–¥–µ–±—ñ–ª—å—à–æ–≥–æ —î –ø–æ–º—ñ—Ä–Ω–∏–º–∏, –ø—Ä–æ—Ç–µ –≤ –æ–∫—Ä–µ–º—ñ –ø–µ—Ä—ñ–æ–¥–∏ —Ä–∏–Ω–æ–∫ –¥–µ–º–æ–Ω—Å—Ç—Ä—É—î –ø—ñ–¥–≤–∏—â–µ–Ω—É –Ω–µ—Å—Ç–∞–±—ñ–ª—å–Ω—ñ—Å—Ç—å.

–¢–∞–∫–∏–º —á–∏–Ω–æ–º, –≤—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è —Ä–æ–∑–ø–æ–¥—ñ–ª—ñ–≤ —î –µ—Ñ–µ–∫—Ç–∏–≤–Ω–∏–º —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–º –ø–µ—Ä–≤–∏–Ω–Ω–æ–≥–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–Ω–æ–≥–æ –∞–Ω–∞–ª—ñ–∑—É —Ñ—ñ–Ω–∞–Ω—Å–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö.