# –ö–∏—ó–≤—Å—å–∫–∏–π –Ω–∞—Ü—ñ–æ–Ω–∞–ª—å–Ω–∏–π —É–Ω—ñ–≤–µ—Ä—Å–∏—Ç–µ—Ç —ñ–º–µ–Ω—ñ –¢–∞—Ä–∞—Å–∞ –®–µ–≤—á–µ–Ω–∫–∞  
## –ú–µ—Ö–∞–Ω—ñ–∫–æ-–º–∞—Ç–µ–º–∞—Ç–∏—á–Ω–∏–π —Ñ–∞–∫—É–ª—å—Ç–µ—Ç  

### –°–ê–ú–û–°–¢–Ü–ô–ù–ê –†–û–ë–û–¢–ê  
–∑ –∫—É—Ä—Å—É  
**¬´–í–°–¢–£–ü –î–û –°–¢–ê–¢–ò–°–¢–ò–ö–ò¬ª**

–Ω–∞ —Ç–µ–º—É:  
**¬´–î–æ–≤—ñ—Ä—á—ñ —ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏ —Ç–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–Ω–∏—Ö –≥—ñ–ø–æ—Ç–µ–∑¬ª**

–í–∏–∫–æ–Ω–∞–ª–∞:  
—Å—Ç—É–¥–µ–Ω—Ç–∫–∞ 2 –∫—É—Ä—Å—É  
—Å–ø–µ—Ü—ñ–∞–ª—å–Ω–æ—Å—Ç—ñ ¬´–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞¬ª  
**–†–∏–±–∞–∫–æ–≤–∞ –ê–ª—å–æ–Ω–∞**

---

## –ú–µ—Ç–∞ —Ä–æ–±–æ—Ç–∏

–ú–µ—Ç–æ—é —Ä–æ–±–æ—Ç–∏ —î –æ—Ü—ñ–Ω–∫–∞ —á–∞—Å—Ç–∫–∏ –¥—ñ—Ç–µ–π —á–æ–ª–æ–≤—ñ—á–æ—ó —Å—Ç–∞—Ç—ñ —É –≤–∏–±—Ä–∞–Ω–∏—Ö —à—Ç–∞—Ç–∞—Ö –°–®–ê, –ø–æ–±—É–¥–æ–≤–∞ –æ–¥–Ω–æ—á–∞—Å–Ω–∏—Ö –¥–æ–≤—ñ—Ä—á–∏—Ö —ñ–Ω—Ç–µ—Ä–≤–∞–ª—ñ–≤ –¥–ª—è —Ü–∏—Ö —á–∞—Å—Ç–æ–∫ —Ç–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–Ω–∏—Ö –≥—ñ–ø–æ—Ç–µ–∑ —â–æ–¥–æ —ó—Ö —Ä—ñ–≤–Ω–æ—Å—Ç—ñ.  
–£ —Ä–æ–±–æ—Ç—ñ –∑–∞—Å—Ç–æ—Å–æ–≤—É—é—Ç—å—Å—è –¥–æ–≤—ñ—Ä—á—ñ —ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏ –í—ñ–ª—å—Å–æ–Ω–∞, –∞—Å–∏–º–ø—Ç–æ—Ç–∏—á–Ω—ñ —Ç–∞ —Ç–æ—á–Ω—ñ –±—ñ–Ω–æ–º—ñ–∞–ª—å–Ω—ñ –∫—Ä–∏—Ç–µ—Ä—ñ—ó, –∞ —Ç–∞–∫–æ–∂ –ø–æ–ø—Ä–∞–≤–∫–∞ –Ω–∞ –º–Ω–æ–∂–∏–Ω–Ω—ñ –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è.

---

## –ü—É–Ω–∫—Ç 1. –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ç–∞ –≤—ñ–¥–±—ñ—Ä –¥–∞–Ω–∏—Ö

–î–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —Ä–æ–±–æ—Ç–∏ –±—É–ª–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–Ω—ñ –¥–∞–Ω—ñ –∑ —Ñ–∞–π–ª—É `ChGendUS2023.csv`, —è–∫–∏–π –º—ñ—Å—Ç–∏—Ç—å —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ —á–∏—Å–µ–ª—å–Ω—ñ—Å—Ç—å –¥—ñ—Ç–µ–π –¥–æ 18 —Ä–æ–∫—ñ–≤ –∑–∞ —Å—Ç–∞—Ç—Ç—é –≤ —Ä—ñ–∑–Ω–∏—Ö —à—Ç–∞—Ç–∞—Ö –°–®–ê —Å—Ç–∞–Ω–æ–º –Ω–∞ 2023 —Ä—ñ–∫.

–Ü–∑ –∑–∞–≥–∞–ª—å–Ω–æ–≥–æ –Ω–∞–±–æ—Ä—É –¥–∞–Ω–∏—Ö –±—É–ª–æ –≤—ñ–¥—ñ–±—Ä–∞–Ω–æ –ø—ñ–¥–º–Ω–æ–∂–∏–Ω—É, —â–æ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î —à—Ç–∞—Ç–∞–º —ñ–Ω–¥–∏–≤—ñ–¥—É–∞–ª—å–Ω–æ–≥–æ –≤–∞—Ä—ñ–∞–Ω—Ç—É 1:  
**Alabama, Hawaii, Massachusetts, New Mexico, Puerto Rico.**

```r
## –†–æ–±–æ—Ç–∞ 4 ‚Äî –ê–Ω–∞–ª—ñ–∑ —á–∞—Å—Ç–æ–∫ (–í–∞—Ä—ñ–∞–Ω—Ç 1)
## –ê–Ω–∞–ª—ñ–∑ –¥–ª—è –í–∞—Ä—ñ–∞–Ω—Ç—É 1: Alabama, Hawaii, Massachusetts, New Mexico, Puerto Rico

required <- c('DescTools','plotrix','dplyr','readr')
for (pkg in required)
  if (!requireNamespace(pkg, quietly=TRUE))
    install.packages(pkg, repos='https://cloud.r-project.org')

library(DescTools)
library(plotrix)
library(dplyr)
library(readr)

plot_dir <- file.path(getwd(),'plots','report4')
out_dir  <- file.path(getwd(),'outputs')
if (!dir.exists(plot_dir)) dir.create(plot_dir, recursive = TRUE)
if (!dir.exists(out_dir)) dir.create(out_dir, recursive = TRUE)

data_file <- file.path(getwd(),'data','ChGendUS2023.csv')
if (!file.exists(data_file))
  stop('Missing data file: data/ChGendUS2023.csv ‚Äî please add it and rerun')

x <- read.csv(data_file, header = TRUE, stringsAsFactors = FALSE)
x$Male <- as.numeric(x$Male)
x$Female <- as.numeric(x$Female)
rownames(x) <- x$Location

–ü—É–Ω–∫—Ç 2. –û–±—á–∏—Å–ª–µ–Ω–Ω—è —á–∞—Å—Ç–æ–∫ –¥—ñ—Ç–µ–π —á–æ–ª–æ–≤—ñ—á–æ—ó —Å—Ç–∞—Ç—ñ

–î–ª—è –∫–æ–∂–Ω–æ–≥–æ —à—Ç–∞—Ç—É –±—É–ª–æ –æ–±—á–∏—Å–ª–µ–Ω–æ —á–∞—Å—Ç–∫—É –¥—ñ—Ç–µ–π —á–æ–ª–æ–≤—ñ—á–æ—ó —Å—Ç–∞—Ç—ñ —Å–µ—Ä–µ–¥ –∑–∞–≥–∞–ª—å–Ω–æ—ó –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –¥—ñ—Ç–µ–π –∑–∞ —Ñ–æ—Ä–º—É–ª–æ—é

ùëù
^
=
Male
Male
+
Female
.
p
^
	‚Äã

=
Male+Female
Male
	‚Äã

.
Stat <- c('Alabama','Hawaii','Massachusetts','New Mexico','Puerto Rico')

y <- x %>%
  filter(Location %in% Stat) %>%
  mutate(
    n = Male + Female,
    fraction = Male / n
  )


–û—Ç—Ä–∏–º–∞–Ω—ñ –æ—Ü—ñ–Ω–∫–∏ —á–∞—Å—Ç–æ–∫ –ø–æ–¥–∞–Ω–æ —É –≤–∏–≥–ª—è–¥—ñ —Ç–∞–±–ª–∏—Ü—ñ —Ä–∞–∑–æ–º —ñ–∑ —á–∏—Å–µ–ª—å–Ω—ñ—Å—Ç—é —Å–ø–æ—Å—Ç–µ—Ä–µ–∂–µ–Ω—å.

–ü—É–Ω–∫—Ç 3. –ü–æ–±—É–¥–æ–≤–∞ –æ–¥–Ω–æ—á–∞—Å–Ω–∏—Ö –¥–æ–≤—ñ—Ä—á–∏—Ö —ñ–Ω—Ç–µ—Ä–≤–∞–ª—ñ–≤

–î–ª—è –æ—Ü—ñ–Ω–∫–∏ –º–∞—Ç–µ–º–∞—Ç–∏—á–Ω–æ–≥–æ —Å–ø–æ–¥—ñ–≤–∞–Ω–Ω—è —á–∞—Å—Ç–∫–∏ –¥—ñ—Ç–µ–π —á–æ–ª–æ–≤—ñ—á–æ—ó —Å—Ç–∞—Ç—ñ –ø–æ–±—É–¥–æ–≤–∞–Ω–æ –æ–¥–Ω–æ—á–∞—Å–Ω—ñ –¥–æ–≤—ñ—Ä—á—ñ —ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏ –í—ñ–ª—å—Å–æ–Ω–∞ –∑ —Ä—ñ–≤–Ω–µ–º –∑–Ω–∞—á—É—â–æ—Å—Ç—ñ

ùõº
=
0.05
Œ±=0.05.

–î–ª—è –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è –æ–¥–Ω–æ—á–∞—Å–Ω–æ—Å—Ç—ñ —ñ–Ω—Ç–µ—Ä–≤–∞–ª—ñ–≤ —Ä—ñ–≤–µ–Ω—å –¥–æ–≤—ñ—Ä–∏ –∫–æ–∂–Ω–æ–≥–æ —ñ–Ω—Ç–µ—Ä–≤–∞–ª—É –±—É–ª–æ —Å–∫–æ—Ä–∏–≥–æ–≤–∞–Ω–æ –∑–∞ —Å—Ö–µ–º–æ—é, –∞–Ω–∞–ª–æ–≥—ñ—á–Ω–æ—é –ø–æ–ø—Ä–∞–≤—Ü—ñ –ë–æ–Ω—Ñ–µ—Ä—Ä–æ–Ω—ñ.

alpha <- 0.05
k <- nrow(y)
per_conf <- (1 - alpha)^(1/k)

ci <- BinomCI(y$Male, y$n,
              conf.level = per_conf,
              sides = 'two.sided',
              method = 'wilson')

y$est <- ci[,1]
y$lower <- ci[,2]
y$upper <- ci[,3]

–ü—É–Ω–∫—Ç 4. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–Ω–æ—ó –≥—ñ–ø–æ—Ç–µ–∑–∏

–ë—É–ª–æ –ø–µ—Ä–µ–≤—ñ—Ä–µ–Ω–æ –æ—Å–Ω–æ–≤–Ω—É –≥—ñ–ø–æ—Ç–µ–∑—É

ùêª
0
:
ùëù
=
0.51
,
H
0
	‚Äã

:p=0.51,

–¥–µ 
ùëù
p ‚Äî —á–∞—Å—Ç–∫–∞ –¥—ñ—Ç–µ–π —á–æ–ª–æ–≤—ñ—á–æ—ó —Å—Ç–∞—Ç—ñ.

–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤–∏–∫–æ–Ω—É–≤–∞–ª–∞—Å—è –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é:

–∞—Å–∏–º–ø—Ç–æ—Ç–∏—á–Ω–æ–≥–æ –∫—Ä–∏—Ç–µ—Ä—ñ—é prop.test;

—Ç–æ—á–Ω–æ–≥–æ –±—ñ–Ω–æ–º—ñ–∞–ª—å–Ω–æ–≥–æ –∫—Ä–∏—Ç–µ—Ä—ñ—é binom.test;

–ø–æ–ø—Ä–∞–≤–∫–∏ –ë–æ–Ω—Ñ–µ—Ä—Ä–æ–Ω—ñ –¥–ª—è –º–Ω–æ–∂–∏–Ω–Ω–∏—Ö –ø–µ—Ä–µ–≤—ñ—Ä–æ–∫.

p0 <- 0.51

y$prop_pval <- sapply(seq_len(nrow(y)), function(i)
  prop.test(y$Male[i], y$n[i], p = p0)$p.value)

y$binom_pval <- sapply(seq_len(nrow(y)), function(i)
  binom.test(y$Male[i], y$n[i], p = p0)$p.value)

y$prop_pval_bonf <- p.adjust(y$prop_pval, method = 'bonferroni')

–ü—É–Ω–∫—Ç 5. –ê–Ω–∞–ª—ñ–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤

–†—ñ—à–µ–Ω–Ω—è –ø—Ä–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–Ω—É –∑–Ω–∞—á—É—â—ñ—Å—Ç—å –ø—Ä–∏–π–º–∞–ª–æ—Å—è –Ω–∞ –æ—Å–Ω–æ–≤—ñ:

–ù–µ–ø–æ—Ç—Ä–∞–ø–ª—è–Ω–Ω—è –∑–Ω–∞—á–µ–Ω–Ω—è 
0.51
0.51 –¥–æ –æ–¥–Ω–æ—á–∞—Å–Ω–æ–≥–æ –¥–æ–≤—ñ—Ä—á–æ–≥–æ —ñ–Ω—Ç–µ—Ä–≤–∞–ª—É –í—ñ–ª—å—Å–æ–Ω–∞;

–°–∫–æ—Ä–∏–≥–æ–≤–∞–Ω–∏—Ö p-–∑–Ω–∞—á–µ–Ω—å (Bonferroni).

y$signif_by_CI <- !(y$lower <= p0 & y$upper >= p0)
y$signif_by_prop_bonf <- y$prop_pval_bonf < alpha

write_csv(y, file.path(out_dir,'4_variant1_results.csv'))


–î–ª—è –Ω–∞–æ—á–Ω–æ–≥–æ –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è —ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏ –±—É–ª–æ –∑–æ–±—Ä–∞–∂–µ–Ω–æ –Ω–∞ –æ–¥–Ω–æ–º—É –≥—Ä–∞—Ñ—ñ–∫—É.

png(filename = file.path(plot_dir,'4_variant1_CIs.png'),
    width = 900, height = 500)

par(mar=c(6,4,2,1))
plotCI(1:nrow(y),
       y = y$est,
       ui = y$upper,
       li = y$lower,
       xaxt='n',
       xlab='',
       ylab='Proportion Male',
       pch=19,
       col='blue')

axis(1, at=1:nrow(y), labels = y$Location, las=2)
abline(h = p0, col='red', lty=2)
title('Simultaneous Wilson CIs (Variant 1)')
dev.off()

–ü—É–Ω–∫—Ç 6. –î–æ–≤—ñ—Ä—á–∏–π —ñ–Ω—Ç–µ—Ä–≤–∞–ª –í—ñ–ª—å—Å–æ–Ω–∞

–î–ª—è –æ–¥–Ω–æ–≥–æ –∑ –æ–±—Ä–∞–Ω–∏—Ö —à—Ç–∞—Ç—ñ–≤ –±—É–ª–æ –¥–æ–¥–∞—Ç–∫–æ–≤–æ —Ä–æ–∑–≥–ª—è–Ω—É—Ç–æ –¥–æ–≤—ñ—Ä—á–∏–π —ñ–Ω—Ç–µ—Ä–≤–∞–ª –í—ñ–ª—å—Å–æ–Ω–∞, –æ–±—á–∏—Å–ª–µ–Ω–∏–π –∞–Ω–∞–ª—ñ—Ç–∏—á–Ω–æ, —Ç–∞ –ø–æ—Ä—ñ–≤–Ω—è–Ω–æ –π–æ–≥–æ –∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏, –æ—Ç—Ä–∏–º–∞–Ω–∏–º–∏ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —Ñ—É–Ω–∫—Ü—ñ—ó BinomCI.

–ë—É–ª–æ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ, —â–æ –º–µ–∂—ñ —ñ–Ω—Ç–µ—Ä–≤–∞–ª—ñ–≤ –∑–±—ñ–≥–∞—é—Ç—å—Å—è, —â–æ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂—É—î –∫–æ—Ä–µ–∫—Ç–Ω—ñ—Å—Ç—å —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–∏—Ö —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—ñ–≤.

–í–∏—Å–Ω–æ–≤–∫–∏

–£ —Ä–æ–±–æ—Ç—ñ –±—É–ª–æ –¥–æ—Å–ª—ñ–¥–∂–µ–Ω–æ –¥–µ–º–æ–≥—Ä–∞—Ñ—ñ—á–Ω—ñ –¥–∞–Ω—ñ —â–æ–¥–æ –≥–µ–Ω–¥–µ—Ä–Ω–æ–≥–æ —Å–∫–ª–∞–¥—É –¥—ñ—Ç–µ–π —É –≤–∏–±—Ä–∞–Ω–∏—Ö —à—Ç–∞—Ç–∞—Ö –°–®–ê. –ü–æ–±—É–¥–æ–≤–∞ –æ–¥–Ω–æ—á–∞—Å–Ω–∏—Ö –¥–æ–≤—ñ—Ä—á–∏—Ö —ñ–Ω—Ç–µ—Ä–≤–∞–ª—ñ–≤ –¥–æ–∑–≤–æ–ª–∏–ª–∞ –æ—Ü—ñ–Ω–∏—Ç–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–Ω—É –Ω–µ–≤–∏–∑–Ω–∞—á–µ–Ω—ñ—Å—Ç—å —á–∞—Å—Ç–æ–∫ –¥—ñ—Ç–µ–π —á–æ–ª–æ–≤—ñ—á–æ—ó —Å—Ç–∞—Ç—ñ —Ç–∞ –ø–æ—Ä—ñ–≤–Ω—è—Ç–∏ —ó—Ö –º—ñ–∂ —à—Ç–∞—Ç–∞–º–∏.

–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–Ω–∏—Ö –≥—ñ–ø–æ—Ç–µ–∑ –ø–æ–∫–∞–∑–∞–ª–∞, —â–æ –¥–ª—è –±—ñ–ª—å—à–æ—Å—Ç—ñ —à—Ç–∞—Ç—ñ–≤ –≤—ñ–¥–º—ñ–Ω–Ω–æ—Å—Ç—ñ —É —á–∞—Å—Ç–∫–∞—Ö –Ω–µ —î —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–Ω–æ –∑–Ω–∞—á—É—â–∏–º–∏. –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —ñ–Ω—Ç–µ—Ä–≤–∞–ª—ñ–≤ –í—ñ–ª—å—Å–æ–Ω–∞ –ø—Ä–æ–¥–µ–º–æ–Ω—Å—Ç—Ä—É–≤–∞–ª–æ —ó—Ö–Ω—é –Ω–∞–¥—ñ–π–Ω—ñ—Å—Ç—å —Ç–∞ —É–∑–≥–æ–¥–∂–µ–Ω—ñ—Å—Ç—å –∑ –∫–ª–∞—Å–∏—á–Ω–∏–º–∏ –∫—Ä–∏—Ç–µ—Ä—ñ—è–º–∏ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –≥—ñ–ø–æ—Ç–µ–∑.

–¢–∞–∫–∏–º —á–∏–Ω–æ–º, –¥–æ–≤—ñ—Ä—á—ñ —ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏ —Ç–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–Ω–∏—Ö –≥—ñ–ø–æ—Ç–µ–∑ —î –µ—Ñ–µ–∫—Ç–∏–≤–Ω–∏–º–∏ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏ –∞–Ω–∞–ª—ñ–∑—É –ø—Ä–æ–ø–æ—Ä—Ü—ñ–π —Ç–∞ –¥–æ–∑–≤–æ–ª—è—é—Ç—å —Ä–æ–±–∏—Ç–∏ –æ–±“ë—Ä—É–Ω—Ç–æ–≤–∞–Ω—ñ —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–Ω—ñ –≤–∏—Å–Ω–æ–≤–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤—ñ —Ä–µ–∞–ª—å–Ω–∏—Ö –¥–∞–Ω–∏—Ö.